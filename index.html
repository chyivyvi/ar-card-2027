<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
  body { margin: 0; overflow: hidden; }
    .ui-container {
    position: fixed; 
    bottom: 30px; 
    left: 50%; 
    transform: translateX(-50%);
    z-index: 1000; /* å¿…é ˆå¤§æ–¼ 1 */
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    gap: 15px; 
    width: 90%;
  }

  .button-group { 
    display: flex; 
    gap: 10px; 
    justify-content: center; 
  }

  button {
    padding: 12px 20px; 
    font-size: 16px; 
    cursor: pointer;
    background: white; 
    border: 2px solid #ffcccc; 
    border-radius: 25px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  .confirm-btn { background-color: #ffcccc; font-weight: bold; }
  .action-btn { background-color: #e0f7fa; border-color: #b2ebf2; }
  .step-hint { 
    background: rgba(0,0,0,0.6); 
    color: white; 
    padding: 8px 20px; 
    border-radius: 20px; 
    font-size: 14px; 
  }
</style>
  </head>

  <body>
    <div class="ui-container">
    <div id="hint" class="step-hint">ç¬¬ä¸€æ­¥ï¼šé¸æ“‡èƒŒæ™¯è£é£¾</div>
    
    <div id="step1-btns" class="button-group">
        <button onclick="selectLayer('deco', 'heart')">â¤ æ„›å¿ƒ</button>
        <button onclick="selectLayer('deco', 'star')">â­ æ˜Ÿæ˜Ÿ</button>
        <button class="confirm-btn" onclick="nextStep(2)">ä¸‹ä¸€å€‹ âœ”</button>
    </div>

    <div id="step2-btns" class="button-group" style="display: none;">
        <button onclick="backToStep1()">â¬… è¿”å›</button>
        <button onclick="selectLayer('ribbon', 'ribbon_a')">ğŸ€ ç·å¸¶</button>
        <button onclick="selectLayer('ribbon', 'bow')">ğŸ è´è¶çµ</button>
        <button class="confirm-btn" onclick="nextStep(3)">å®Œæˆ âœ”</button>
    </div>

    <div id="step3-btns" class="button-group" style="display: none;">
        <button id="btn-3d" class="action-btn" onclick="toggle3D()">ğŸ‘ å¬å–šå°ç¾Š</button>
        <button class="action-btn" onclick="enterPhotoMode(event)">ğŸ“¸ éš±è—ä»‹é¢åˆç…§</button>
        <button onclick="resetGame()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
    </div>
    </div>
    
    <a-scene mindar-image="imageTargetSrc: ./targets.mind; autoStart: true; uiLoading: no;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights: true" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
    
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0">
        <a-image id="base-sheep" src="sheep.png" position="0 0 0" width="1" height="1"></a-image>

        <a-image id="layer-heart" src="heart.png" position="0 0 0.01" width="1" height="1" visible="false"
                 animation="property: scale; from: 1 1 1; to: 1.1 1.1 1.1; dir: alternate; dur: 600; loop: true; easing: easeInOutSine"></a-image>
        <a-image id="layer-star" src="star.png" position="0 0 0.01" width="1" height="1" visible="false"
                 animation="property: rotation; from: 0 0 0; to: 0 0 360; dur: 5000; loop: true; easing: linear"></a-image>

        <a-image id="layer-ribbon_a" src="ribbon.png" position="0 0 0.02" width="1" height="1" visible="false"></a-image>
        <a-image id="layer-bow" src="bow.png" position="0 0 0.02" width="1" height="1" visible="false"></a-image>

        <a-gltf-model id="layer-3d" src="test.glb" position="-0.4 0 0.05" scale="0 0 0" visible="false"
                      animation="property: rotation; from: 0 0 0; to: 0 360 0; loop: true; dur: 5000; easing: linear">
        </a-gltf-model>
    </a-entity>
</a-scene>
    <script>
      // --- åŸºç¤åœ–å±¤åˆ‡æ› ---
function selectLayer(group, item) {
    if (group === 'deco') {
        document.querySelector('#layer-heart').setAttribute('visible', item === 'heart');
        document.querySelector('#layer-star').setAttribute('visible', item === 'star');
    } else if (group === 'ribbon') {
        document.querySelector('#layer-ribbon_a').setAttribute('visible', item === 'ribbon_a');
        document.querySelector('#layer-bow').setAttribute('visible', item === 'bow');
    }
}

// --- æ­¥é©Ÿæ§åˆ¶ ---
function nextStep(step) {
    hideAllUI();
    if (step === 2) {
        document.getElementById('step2-btns').style.display = 'flex';
        document.getElementById('hint').innerText = 'ç¬¬äºŒæ­¥ï¼šåŠ ä¸Šé£¾å“';
    } else if (step === 3) {
        document.getElementById('step3-btns').style.display = 'flex';
        document.getElementById('hint').innerText = 'æœ€å¾Œä¸€æ­¥ï¼šå¬å–š 3D å°ç¾Šï¼';
    }
}

function hideAllUI() {
    document.getElementById('step1-btns').style.display = 'none';
    document.getElementById('step2-btns').style.display = 'none';
    document.getElementById('step3-btns').style.display = 'none';
}

function backToStep1() {
    hideAllUI();
    document.getElementById('step1-btns').style.display = 'flex';
    document.getElementById('hint').innerText = 'ç¬¬ä¸€æ­¥ï¼šé¸æ“‡èƒŒæ™¯è£é£¾';
}

// --- 3D å¬å–šç‰¹æ•ˆ ---
function toggle3D() {
    const model3d = document.querySelector('#layer-3d');
    const btn = document.getElementById('btn-3d');
    
    const currentVisible = model3d.getAttribute('visible');
    const isVisible = (currentVisible === true || currentVisible === 'true');

    if (!isVisible) {
        // å¬å–šå‰å…ˆç§»é™¤å¯èƒ½æ®˜ç•™çš„å‹•ç•«çµ„ä»¶ ---
        model3d.removeAttribute('animation__scale'); 
        
        model3d.setAttribute('visible', 'true');
        // ä½¿ç”¨ setTimeout ç¢ºä¿å±¬æ€§æ›´æ–°å¾Œæ‰åŸ·è¡Œæ–°å‹•ç•«
        setTimeout(() => {
            model3d.setAttribute('animation__scale', {
                property: 'scale',
                from: '0 0 0',
                to: '0.2 0.2 0.2',
                dur: 800,
                easing: 'easeOutBack'
            });
        }, 10);
        btn.innerText = 'æ”¶å›å°ç¾Š';
    } else {
        // æ”¶å›æ™‚ç›´æ¥ç§»é™¤å‹•ç•«ï¼Œä¸¦é‡ç½®æ•¸å€¼ ---
        model3d.removeAttribute('animation__scale');
        model3d.setAttribute('visible', 'false');
        model3d.setAttribute('scale', '0 0 0'); 
        btn.innerText = 'å¬å–šå°ç¾Š';
    }
}
// --- éš±è—ä»‹é¢èˆ‡å–šå› ---
function enterPhotoMode(event) {
    if (event) event.stopPropagation();
    document.querySelector('.ui-container').style.display = 'none';
    document.getElementById('hint').style.display = 'none'; 
    setTimeout(() => {
        document.addEventListener('pointerdown', exitPhotoMode, { once: true });
    }, 300);
}

function exitPhotoMode() {
    // 1. é‡æ–°é¡¯ç¤º UI å®¹å™¨èˆ‡æç¤ºå­—
    document.querySelector('.ui-container').style.display = 'flex';
    document.getElementById('hint').style.display = 'block'; 
    
    // 2. æ¸…ç†ç›£è½å™¨
    document.removeEventListener('pointerdown', exitPhotoMode);

    // 3. ç¢ºä¿ step3 çš„æŒ‰éˆ•çµ„æ˜¯é¡¯ç¤ºçš„ï¼Œä½†ä¸é‡ç½®å…§éƒ¨é‚è¼¯
    hideAllUI();
    document.getElementById('step3-btns').style.display = 'flex';
    document.getElementById('hint').innerText = 'æœ€å¾Œä¸€æ­¥ï¼šå¬å–š 3D å°ç¾Šï¼';
}

function resetGame() {
    const layers = ['#layer-heart', '#layer-star', '#layer-ribbon_a', '#layer-bow', '#layer-3d'];
    layers.forEach(id => {
        const el = document.querySelector(id);
        if (el) {
            // å¦‚æœæ˜¯ 3D ç‰©ä»¶ï¼Œé¡å¤–ç§»é™¤å‹•ç•«çµ„ä»¶
            if (id === '#layer-3d') {
                el.removeAttribute('animation__scale');
                el.setAttribute('scale', '0 0 0');
            } else {
                el.setAttribute('scale', '1 1 1');
            }
            el.setAttribute('visible', 'false');
        }
    });
    
    const btn = document.getElementById('btn-3d');
    if (btn) btn.innerText = 'ğŸ‘ å¬å–šå°ç¾Š';
    
    // ç§»é™¤å¯èƒ½æ®˜ç•™çš„æ‹ç…§æ¨¡å¼ç›£è½å™¨
    document.removeEventListener('pointerdown', exitPhotoMode);
    
    backToStep1();
}
    </script>
  </body>
</html>





